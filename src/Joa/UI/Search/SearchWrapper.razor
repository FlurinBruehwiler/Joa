@using Joa.Hotkey
@using Joa.Injectables
@using Microsoft.Extensions.DependencyInjection
@using Photino.Blazor
@inject JoaManager JoaManager 
@inject PhotinoBlazorApp PhotinoBlazorApp 

@if (_showSearch)
{
    <SearchComponent @ref="_searchComponent"></SearchComponent>
}
else
{
    <p>Search not availablefd</p>
}

@code {
    private bool _showSearch = true;
    private SearchComponent? _searchComponent;
    
    protected override void OnInitialized()
    {
        PhotinoBlazorApp.MainWindow.RegisterFocusOutHandler((sender, args) =>
        {
            _searchComponent?.HideWindow();
        });
        
        JoaManager.CurrentScope?.ServiceProvider
            .GetRequiredService<GlobalHotKey>()
            .InitialHotKeyRegistration(() =>
            {

                PhotinoBlazorApp.MainWindow.Invoke(() =>
                {
                    var handle = PhotinoBlazorApp.MainWindow.WindowHandle;
                    PhotinoBlazorApp.MainWindow.SetHidden(false);
                    External.SetForegroundWindow(handle);
                });
            });

        JoaManager.ShowUi = async showUi =>
        {
            await InvokeAsync(() =>
            {
                _showSearch = showUi;
                StateHasChanged();
            });
        };

        base.OnInitialized();
    }
}